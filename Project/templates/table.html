{% load static %}

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Poker Table</title>
    <link rel="stylesheet" type="text/css" href="{% static 'css/table.css' %}">
</head>
<body>
    <div class="container">
        <button class="exit-game-btn" id="exit-game-btn">Exit Game</button>
       
        
        <div class="poker-table">
            <!-- Top Icons -->
            <div class="top-icons">
                <button class="icon-button">ℹ</button>
                <button class="icon-button">⚙</button>
            </div>
            
            <!-- Poker Table -->
            <div class="table">
                <!-- Players -->
                <div class="player top-left" id="player-1">
                    <img src="player1.jpg" alt="Player 1" class="player-img">
                    <div class="player-info">
                        <div class="player-name">Player 1</div>
                        <div class="player-score">♦ 1,600</div>
                    </div>
                </div>
                <div class="player top-right" id="player-2">
                    <img src="player2.jpg" alt="Player 2" class="player-img">
                    <div class="player-info">
                        <div class="player-name">Player 2</div>
                        <div class="player-score">♦ 3,200</div>
                    </div>
                </div>
                <div class="player bottom-left" id="player-3">
                    <img src="player3.jpg" alt="Player 3" class="player-img">
                    <div class="player-info">
                        <div class="player-name">Player 3</div>
                        <div class="player-score">♦ 2,400</div>
                    </div>
                </div>
                <div class="player bottom-right" id="player-4">
                    <img src="player4.jpg" alt="Player 4" class="player-img">
                    <div class="player-info">
                        <div class="player-name">Player 4</div>
                        <div class="player-score">♦ 4,800</div>
                    </div>
                </div>
                
                <!-- Center Content -->
                <div class="center-content">
                    <div class="table-limit">Table Limit</div>
                    <div class="table-pot" id="table-pot">120,000</div>
                    <div class="current-bet" id="current-bet">♦ 12,800</div>
                    <div class="progress-bar"><div class="progress"></div></div>
                    <div class="cards" id="player-cards">
                        <div class="card">A♥</div>
                        <div class="card">K♠</div>
                        <div class="card">Q♠</div>
                    </div>
                </div>
            </div>
            
            <!-- Bottom Controls -->
            <div class="controls">
                <button class="control-button red" id="pack-btn">Pack</button>
                <button class="control-button purple" id="sideshow-btn">Sideshow</button>
            </div>
        </div>
    </div>

    

</body>
</html>
<script>
   console.log("Loading Javascript");
    let gameRoomId = "{{ game_room_id }}";  // Ensure this value is correctly rendered from the context
    console.log("Game Room ID:", gameRoomId);

const socket = new WebSocket(`ws://${window.location.host}/ws/game/${gameRoomId}/`);

socket.onopen = function(e) {
    console.log("Connected to game room");
};

socket.onmessage = function(e) {
    const data = JSON.parse(e.data);
    console.log("Received game data:", data);
    updateGameUI(data);
    if (data.players) {
        updatePlayersList(data.players);
    }
    if (data.type === "player_disconnected") {
        // Handle player leaving scenario
        console.log(`Player ${data.player_id} has disconnected.`);
        removePlayerFromUI(data.player_id);
    }
};

function removePlayerFromUI(playerId) {
    const playerElement = document.getElementById(`player-${playerId}`);
    if (playerElement) {
        playerElement.remove();
        console.log(`Player ${playerId} removed from UI`);
    }
}

function updatePlayersList(players) {
    const playerList = document.getElementById("player-list");
    playerList.innerHTML = "";

    players.forEach(player => {
        const li = document.createElement("li");
        li.textContent = `${player.username} (${player.status})`;
        playerList.appendChild(li);
    });
}

socket.onclose = function(e) {
    console.log("Disconnected from game room");
};

function updateGameUI(data) {
    document.getElementById("table-pot").textContent = data.pot;
    document.getElementById("current-bet").textContent = `♦ ${data.current_bet}`;
    
    if (data.players) {
        data.players.forEach(player => {
            const playerElement = document.querySelector(`#player-${player.id} .player-score`);
            if (playerElement) {
                playerElement.textContent = player.status;
            }
        });
    }
}


const exitButton = document.getElementById("exit-game-btn");

exitButton.addEventListener("click", function() {
    // Redirect to the interface page
    window.location.href = "/gamedevelopment/interface/";

});



// function placeBet(amount) {
//     const data = {
//         action: 'place_bet',
//         player_id: 1,  // Player ID
//         amount: amount
//     };
//     socket.send(JSON.stringify(data));
// }

// function packGame() {
//     const data = {
//         action: 'pack',
//         player_id: {{ user.id }}
//         // Player ID
//     };
//     socket.send(JSON.stringify(data));
//     document.getElementById("pack-btn").disabled = true;
// }

// function requestSideshow() {
//     const data = {
//         action: 'sideshow',
//         player_id: {{ user.id }}  // Player ID
//     };
//     socket.send(JSON.stringify(data));
// }

// document.getElementById("pack-btn").addEventListener("click", packGame);
// document.getElementById("sideshow-btn").addEventListener("click", requestSideshow); 

</script>
